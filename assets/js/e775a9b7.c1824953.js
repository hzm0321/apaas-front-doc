"use strict";(self.webpackChunkapaas_front_doc=self.webpackChunkapaas_front_doc||[]).push([[142],{73143:e=>{e.exports=JSON.parse('{"blogPosts":[{"id":"Promise \u77e5\u8bc6\u70b9","metadata":{"permalink":"/apaas-front-doc/blog/Promise \u77e5\u8bc6\u70b9","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2022-08-01-Promise/index.md","source":"@site/blog/2022-08-01-Promise/index.md","title":"Promise \u77e5\u8bc6\u70b9","description":"\u56de\u8c03\u5730\u57df\u95ee\u9898","date":"2022-08-01T00:00:00.000Z","formattedDate":"2022\u5e748\u67081\u65e5","tags":[{"label":"JavaScript","permalink":"/apaas-front-doc/blog/tags/java-script"},{"label":"ES6","permalink":"/apaas-front-doc/blog/tags/es-6"},{"label":"Promise","permalink":"/apaas-front-doc/blog/tags/promise"}],"readingTime":6.615,"hasTruncateMarker":false,"authors":[{"name":"\u6c5f\u5357\u70df\u96e8","title":"\u70df\u82b1\u6613\u51b7","url":"https://github.com/hzm0321","imageURL":"https://wx.qlogo.cn/mmhead/Q3auHgzwzM7zVzxH0RqANaicqicqbupmUN6qB5KjBsLfRKf1JdT6UOAw/0","key":"hzm"}],"frontMatter":{"slug":"Promise \u77e5\u8bc6\u70b9","title":"Promise \u77e5\u8bc6\u70b9","authors":["hzm"],"tags":["JavaScript","ES6","Promise"]}},"content":"### \u56de\u8c03\u5730\u57df\u95ee\u9898\\n\\n\u4f20\u7edf\u7684\u5f02\u6b65\u7f16\u7a0b\u65b9\u5f0f\u901a\u8fc7\u56de\u8c03\u51fd\u6570\uff0c\u5904\u7406\u5f02\u6b65\u4efb\u52a1\u5230\u671f\u7684\u6267\u884c\u95ee\u9898\u3002\u800c\u5f02\u6b65\u4efb\u52a1\u4e4b\u95f4\u5982\u679c\u4ea7\u751f\u4f9d\u8d56\u5173\u7cfb\uff0c\u5c31\u4f1a\u9677\u5165\u201c\u56de\u8c03\u5730\u57df\u201d\u95ee\u9898\u3002\\n\\n![callback](./callback.png)\\n\\n### \u72b6\u6001\\n`Promise` \u7684\u72b6\u6001`\u4e0d\u53ef\u9006`  \\n\u67093\u4e2a\u72b6\u6001\\n- **Pending**\\n- **Resolved**\\n- **Rejected**\\n\\n### \u9759\u6001\u65b9\u6cd5\\n\\n- **Promise.resolve**\\n- **Promise.reject**\\n\\n:::tip\\n\\n\u53ea\u63a5\u6536\u7b2c\u4e00\u4e2a\u53c2\u6570\\n\\n:::\\n\\n### \u5b9e\u4f8b\u65b9\u6cd5\\n\\n#### .then\\n\\n\u63a5\u65362\u4e2a\u53c2\u6570\uff0c`resolve` \u65b9\u6cd5\u548c `reject` \u65b9\u6cd5\uff0c\u5f62\u53c2\u4e3a\u4e0a\u4e00\u6b21\u72b6\u6001\u7684\u503c\u3002\u4e14\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u4e92\u65a5\uff0c\u53ea\u80fd\u8fdb\u5165\u4e00\u4e2a\u3002  \\n\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 Promise \u5b9e\u4f8b\u3002\\n\\n**\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a resolve \u72b6\u6001\u7684\u65b9\u5f0f\uff1a**\\n- return \u4e00\u4e2a\u503c\\n- return Promise.resolve(\u503c)\\n- \u4e0d\u5199 return\uff0c\u9ed8\u8ba4\u8fd4\u56de resolved \uff0c\u4f20\u9012\u7684\u503c\u4e3a `undefined`\\n\\n**\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a rejected \u72b6\u6001\u7684\u65b9\u5f0f\uff1a**\\n- throw \u629b\u51fa\u4e00\u4e2a\u9519\u8bef\\n- return Promise.reject(\u503c)\\n- \u9519\u8bef\u4ee3\u7801\\n\\n#### .catch\\n\u63a5\u65361\u4e2a\u53c2\u6570\uff0c`reject` \u65b9\u6cd5\u3002\u5f62\u53c2\u4e3a\u4e0a\u4e00\u6b21 reject \u72b6\u6001\u7684\u503c\\n\u8fd4\u56de\u503c\u540c `.then` ,\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a`\u65b0\u7684 Promise`\\n\\n#### .finally\\n\u63a5\u6536\u4e00\u4e2a\u65b9\u6cd5\uff0c\u6ca1\u6709\u4efb\u4f55\u72b6\u6001\u503c\\n\u8fd4\u56de\u503c\u540c `.then` ,\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a`\u65b0\u7684 Promise`\\n\\n\u8fd4\u56de\u5f85\u5b9a Promise \uff0c\u53ea\u8981 Promise \u4e00\u89e3\u51b3\uff0c\u65b0 Promise \u4ecd\u7136\u4f1a\u539f\u6837\u540e\u4f20\u521d\u59cb\u7684 Promise\\n\\n```javascript\\nlet p1  = Promise.resolve(1);\\nlet p2 = p1.finally(() => {\\n  return new Promise((resolve, reject)=>{\\nsetTimeout(resolve,100,2)\\n  })\\n})\\n\\n\\n\\nsetTimeout(() => {\\n  setTimeout(console.log, 0, p2); // 1\\n},200)\\n```\\n### Thenable \u63a5\u53e3\u5bf9\u8c61\\n\\n\u5982\u679c\u8fd4\u56de\u4e00\u4e2a \u5b9e\u73b0\u4e86 `thenable` \u7684\u63a5\u53e3\u5bf9\u8c61\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 Promise \u4e0a\u7684 resolve \u548c reject \u65b9\u6cd5\u3002\\n\\n```javascript\\nconst p  = new Promise((resolve, reject) => {\\n  resolve(1)\\n}).then(() => {\\n  return {\\n    // \u5b9e\u73b0\u4e86 thenable \u63a5\u53e3\u5bf9\u8c61\\n    then: (resolve, reject) => {\\n      reject(2);\\n    }\\n  }\\n}).catch((error) => {\\n  return error\\n})\\n\\nsetTimeout(console.log,0,p)\\n```\\n\\n### \u5e42\u7b49\u6027(resolve)\\n\\n\u7ed9 Promise \u4f20\u5165 \u9759\u6001 Promise\uff0c\u7c7b\u4f3c\u4e8e\u7a7a\u5305\u88c5  \\n\\n```javascript\\nconst p = Promise.resolve(1);  \\nconsole.log(p === Promise.resolve(p)); // true  \\n```\\n\\n:::tip\\n\\n`Promise.reject` \u6ca1\u6709\u5e42\u7b49\u6027\uff0c\u7ed9\u5b83\u4f20\u5165\u4e00\u4e2a Promise\u5bf9\u8c61\uff0c\u4f1a\u53d8\u6210\u62d2\u7edd\u7684\u7406\u7531\\n\\n:::\\n\\n### \u4e8c\u5143\u6027\\n\\n\u540c\u6b65\u5bf9\u8c61(\u5728\u540c\u6b65\u6267\u884c\u6a21\u5f0f\u4e2d\u4f7f\u7528)\uff0c\u4f46\u4e5f\u662f\u5f02\u6b65\u6267\u884c\u6a21\u5f0f\u7684\u5a92\u4ecb \u3002\\n\\n```javascript\\n try {\\n    Promise.reject(new Error(\\"bar\\"));\\n  } catch (e) {\\n    // Promise.reject \u4e0d\u4f1a\u8fdb\u5165\\n    console.log(e);\\n  }\\n```\\n\\n### \u503c\u7a7f\u900f\\n\\n\u4f20\u7ed9 `then()` \u7684\u4efb\u4f55`\u975e\u51fd\u6570\u7c7b\u578b\u7684\u53c2\u6570`\u90fd\u4f1a\u88ab\u9759\u9ed8\u5ffd\u7565\\n\\n```javascript\\nlet p1  = Promise.resolve(1);\\nlet p2 = p1.then(2).then({}).then(undefined).then((res) => {\\n  console.log(res); // 1\\n})\\n```\\n\\n### \u72b6\u6001\u7a7f\u900f\\n\\n\u5e76\u4e0d\u662f\u8c03\u7528\u4e86 `resolve \u65b9\u6cd5`\u5c31\u4e00\u5b9a\u4f1a\u8fdb\u5165\u5b8c\u6210\u72b6\u6001\uff0c\u5982\u679c\u4f20\u5165\u7684\u662f\u4e00\u4e2a `promise \u72b6\u6001`\uff0c\u90a3\u4e48\u6700\u7ec8\u72b6\u6001\u7531\u8be5 promise \u72b6\u6001\u51b3\u5b9a\\n\\n### \u4e8b\u4ef6\u5faa\u73af\u673a\u5236\\n\\nPromise \u5c5e\u4e8e `\u5fae\u4efb\u52a1`\\n\\n### \u6279\u5904\u7406\\n\\n\u53ef\u4ee5\u7ed9 Promise \u6dfb\u52a0\u591a\u4e2a\u4efb\u52a1\uff0c\u6309\u6dfb\u52a0\u7684\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\\n\\n```javascript\\nlet p1 = Promise.resolve();\\np1.then(() => setTimeout(console.log, 0, 1));\\np1.then(() => setTimeout(console.log, 0, 2));\\n// 1\\n// 2\\n```\\n\\n### \u4e2d\u65ad Promise \u94fe\\n\\n\u5728\u94fe\u8def\u4e2d\u8fd4\u56de `pending` \u72b6\u6001\u7684 Promise \uff0c\u5373\u53ef\u4e2d\u65ad\u540e\u7eed\u94fe\u8def\u3002\\n\\n```javascript\\nconst p1 = new Promise((resolve, reject) => {\\n  resolve(1);\\n}).then((res) => {\\n  console.log(res);\\n  // \u4e2d\u65ad\\n  return new Promise(()=>{})\\n}).then((res) => {\\n  console.log(res)\\n})\\n```\\n\\n### Promise \u961f\u5217\\n\\n**reduce \u5b9e\u73b0**\\n\\n```javascript\\nconst p1 = new Promise((resolve, reject) => {\\n  setTimeout(() => {\\n    resolve(1)\\n  },2000)\\n})\\n\\nconst p2 = new Promise((resolve) => {\\n  setTimeout(() => {\\n    resolve(2)\\n  },1000)\\n});\\n\\nconst p3 = new Promise((resolve) => {\\n  setTimeout(() => {\\n    resolve(3)\\n  },1000)\\n});\\n\\nconst promiseQueue = [p1,p2,p3];\\npromiseQueue.reduce((pre, cur) => {\\n  return pre.then(() =>{\\n    return cur.then((res) => {\\n      console.log(res)\\n    })\\n  })\\n},Promise.resolve())\\n```\\n\\n**forEach \u5b9e\u73b0**\\n\\n```javascript\\nconst numbs = [1,2,3,4];\\n\\nlet promise = Promise.resolve();\\n\\nnumbs.forEach((v) => {\\n  promise = promise.then(() => {\\n    return new Promise((resolve)=>{\\n      setTimeout(() => {\\n        console.log(v);\\n        resolve();\\n      },1000)\\n    })\\n  })\\n})\\n```\\n\\n### Promise.all\\n\\n\u63a5\u6536\u4e00\u4e2a Promise \u5b9e\u4f8b\u6570\u7ec4  \\n\u6570\u7ec4\u5185\u7684\u5168\u90e8 Promise \u5b9e\u4f8b`\u5168\u90fd\u53d8\u6210\u4e86 resolve \u72b6\u6001`\uff0c\u5c31\u8fdb\u5165 resolved \u72b6\u6001\u3002\u5982\u679c`\u6709\u4e00\u4e2a rejected` \u5c31\u8fdb\u5165 rejected \u72b6\u6001\u3002  \\n\u5982\u679c\u8fdb\u5165 resolved \u72b6\u6001\uff0c\u8fd4\u56de\u7684\u65b0 Promise \u5b9e\u4f8b\u7b2c\u4e00\u4e2a\u65b9\u6cd5\u53c2\u6570\u4f1a\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u4f20\u5165\u6bcf\u9879\u7ed3\u679c\u3002  \\n\u5982\u679c\u8fdb\u5165 rejected \u72b6\u6001\uff0c\u8fd4\u56de\u7684\u65b0 Promise \u5b9e\u4f8b\u7b2c\u4e8c\u4e2a\u65b9\u6cd5\u53c2\u6570\u4f1a\u4ee5\u5355\u4e2a\u503c\u7684\u5f62\u5f0f\u4f20\u5165\u62d2\u7edd\u7684\u7ed3\u679c\u3002  \\n\\n```javascript\\n// resolved \u72b6\u6001\\nconst p1 = Promise.resolve(1);\\nconst p2 = Promise.resolve(2);\\n\\nPromise.all([p1, p2]).then((res) => {\\n  console.log(res); // \u6253\u5370 [1,2]\\n}, (res) => {\\n  console.log(res);\\n})\\n\\n// rejected \u72b6\u6001\\nconst p1 = Promise.resolve(1);\\nconst p2 = Promise.reject(2);\\n\\nPromise.all([p1, p2]).then((res) => {\\n  console.log(res);\\n}, (res) => {\\n  console.log(res); // \u6253\u5370 2\\n})\\n```\\n\\n### Promise.race\\n\\n\u63a5\u6536\u4e00\u4e2a Promise \u5b9e\u4f8b\u6570\u7ec4  \\n\u53ea\u8981 Promise \u5b9e\u4f8b\u6570\u7ec4\u4e4b\u4e2d`\u6709\u4e00\u4e2a\u5b9e\u4f8b\u7387\u5148\u6539\u53d8\u72b6\u6001`\uff0cPromise.reace \u7684\u72b6\u6001\u5c31`\u8ddf\u7740\u6539\u53d8`\u3002\u90a3\u4e2a\u7387\u5148\u6539\u53d8\u7684 Promise \u5b9e\u4f8b\u7684\u8fd4\u56de\u503c\uff0c\u5c31\u4f20\u9012\u7ed9 Promise.reace \u7684\u56de\u8c03\u51fd\u6570\u3002  \\n\u8fd4\u56de\u7684\u65b0\u7684 Promise \u5b9e\u4f8b\uff0c\u4f1a\u4f20\u5165\u7b2c\u4e00\u4e2a\u6539\u53d8\u7684 Promise \u7ed3\u679c\u3002\\n\\n```javascript\\nconst p1 = Promise.resolve(1); // \u7387\u5148\u6539\u53d8\\nconst p2 = Promise.reject(2);\\n\\nPromise.race([p1, p2]).then((res) => {\\n  console.log(res); // 1\\n}, (res) => {\\n  console.log(res);\\n})\\n```\\n\\n### Promise.allSettled\\n\\n\u63a5\u6536\u4e00\u4e2a Promise \u5b9e\u4f8b\u6570\u7ec4  \\n\u53ea\u6709\u7b49\u5230\u53c2\u6570\u6570\u7ec4\u7684`\u6240\u6709 Promise \u5bf9\u8c61\u90fd\u53d1\u751f\u72b6\u6001\u53d8\u66f4\uff08\u4e0d\u7ba1\u662f resolved \u8fd8\u662f rejected \uff09`\uff0c\u8fd4\u56de\u7684 Promise \u5bf9\u8c61\u624d\u4f1a\u53d1\u751f\u72b6\u6001\u53d8\u66f4\u3002  \\n\u8fd4\u56de\u7684\u65b0\u7684 Promise \u5b9e\u4f8b\uff0c\u53ea\u63a5\u6536\u7b2c\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u4e14\u72b6\u6001\u4e3a resolved,\u4ee5\u6570\u7ec4\u7684\u5f62\u5f0f\u4f20\u5165\u6bcf\u9879\u7ed3\u679c\u3002\u6570\u7ec4\u7531\u5bf9\u8c61\u7ec4\u6210\u3002\u5bf9\u8c61\u4e2d\u5305\u542b2\u4e2a\u503c\u2014\u2014status\uff08Promise\u72b6\u6001\uff09 \u548c value\u3002\\n\\n```javascript\\nconst p1 = Promise.resolve(1);\\nconst p2 = Promise.reject(2);\\n\\nPromise.allSettled([p1, p2]).then((res) => {\\n  console.log(res); // [{ status: \'fulfilled\', value: 1 },{ status: \'rejected\', reason: 2 }]\\n})\\n```\\n\\n### Promise.any(ES 2021 \u65b0\u7279\u6027)\\n\\n\u63a5\u6536\u4e00\u4e2a Promise \u5b9e\u4f8b\u6570\u7ec4  \\n\u53ea\u8981\u53c2\u6570\u5b9e\u4f8b`\u6709\u4e00\u4e2a\u53d8\u6210 fulfilled \u72b6\u6001\uff0c\u5305\u88c5\u5b9e\u4f8b\u5c31\u4f1a\u53d8\u6210 fulfilled \u72b6\u6001`\uff1b\u5982\u679c\u6240\u6709\u53c2\u6570\u5b9e\u4f8b\u90fd\u53d8\u6210 rejected \u72b6\u6001\uff0c\u5305\u88c5\u5b9e\u4f8b\u5c31\u4f1a\u53d8\u6210 rejected \u72b6\u6001\u3002\\n\\n### \u5c01\u88c5\u4e00\u4e2a\u7b80\u6613\u5b9a\u65f6\u5668\\n\\n```javascript\\nfunction timeout(delay = 1000) {\\n  return new Promise((resolve, reject) => {\\n    setTimeout(() => {\\n      resolve();\\n    }, delay)\\n  })\\n}\\n```\\n\\n### \u8bed\u6cd5\u7cd6 async await"}]}')}}]);