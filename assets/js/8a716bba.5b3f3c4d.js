"use strict";(self.webpackChunkapaas_front_doc=self.webpackChunkapaas_front_doc||[]).push([[6449],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>g});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},d=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=c(t),g=a,m=p["".concat(l,".").concat(g)]||p[g]||u[g]||o;return t?r.createElement(m,s(s({ref:n},d),{},{components:t})):r.createElement(m,s({ref:n},d))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,s=new Array(o);s[0]=p;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=t[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},5162:(e,n,t)=>{t.d(n,{Z:()=>s});var r=t(7294),a=t(6010);const o="tabItem_Ymn6";function s(e){let{children:n,hidden:t,className:s}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o,s),hidden:t},n)}},4866:(e,n,t)=>{t.d(n,{Z:()=>R});var r=t(7462),a=t(7294),o=t(6010),s=t(2466),i=t(6775),l=t(1980),c=t(7392),d=t(12);function u(e){return function(e){var n,t;return null!=(n=null==(t=a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:a}}=e;return{value:n,label:t,attributes:r,default:a}}))}function p(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=null!=n?n:u(t);return function(e){const n=(0,c.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function g(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const r=(0,i.k6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,l._X)(o),(0,a.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(r.location.search);n.set(o,e),r.replace({...r.location,search:n.toString()})}),[o,r])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,o=p(e),[s,i]=(0,a.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!g({value:t,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+r.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const a=null!=(n=r.find((e=>e.default)))?n:r[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:o}))),[l,c]=m({queryString:t,groupId:r}),[u,f]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[r,o]=(0,d.Nk)(t);return[r,(0,a.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:r}),h=(()=>{const e=null!=l?l:u;return g({value:e,tabValues:o})?e:null})();(0,a.useLayoutEffect)((()=>{h&&i(h)}),[h]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!g({value:e,tabValues:o}))throw new Error("Can't select invalid tab value="+e);i(e),c(e),f(e)}),[c,f,o]),tabValues:o}}var h=t(2389);const k="tabList__CuJ",b="tabItem_LNqP";function N(e){let{className:n,block:t,selectedValue:i,selectValue:l,tabValues:c}=e;const d=[],{blockElementScrollPositionUntilNextRender:u}=(0,s.o5)(),p=e=>{const n=e.currentTarget,t=d.indexOf(n),r=c[t].value;r!==i&&(u(n),l(r))},g=e=>{var n;let t=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{var r;const n=d.indexOf(e.currentTarget)+1;t=null!=(r=d[n])?r:d[0];break}case"ArrowLeft":{var a;const n=d.indexOf(e.currentTarget)-1;t=null!=(a=d[n])?a:d[d.length-1];break}}null==(n=t)||n.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},n)},c.map((e=>{let{value:n,label:t,attributes:s}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,key:n,ref:e=>d.push(e),onKeyDown:g,onClick:p},s,{className:(0,o.Z)("tabs__item",b,null==s?void 0:s.className,{"tabs__item--active":i===n})}),null!=t?t:n)})))}function E(e){let{lazy:n,children:t,selectedValue:r}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},o.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r}))))}function x(e){const n=f(e);return a.createElement("div",{className:(0,o.Z)("tabs-container",k)},a.createElement(N,(0,r.Z)({},e,n)),a.createElement(E,(0,r.Z)({},e,n)))}function R(e){const n=(0,h.Z)();return a.createElement(x,(0,r.Z)({key:String(n)},e))}},998:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>g,frontMatter:()=>i,metadata:()=>c,toc:()=>u});var r=t(7462),a=(t(7294),t(3905)),o=t(4866),s=t(5162);const i={slug:"ER",title:"\u57fa\u4e8e antv/x6 \u5b9e\u73b0 ER \u56fe",authors:["hzm"],tags:["antv/x6","er"]},l=void 0,c={permalink:"/apaas-front-doc/blog/ER",source:"@site/blog/2023-05-06-er/index.md",title:"\u57fa\u4e8e antv/x6 \u5b9e\u73b0 ER \u56fe",description:"X6 \u662f AntV \u65d7\u4e0b\u7684\u56fe\u7f16\u8f91\u5f15\u64ce\uff0c\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u5f00\u7bb1\u5373\u7528\u7684\u4ea4\u4e92\u7ec4\u4ef6\u548c\u7b80\u5355\u6613\u7528\u7684\u8282\u70b9\u5b9a\u5236\u80fd\u529b\uff0c\u65b9\u4fbf\u6211\u4eec\u5feb\u901f\u642d\u5efa\u6d41\u7a0b\u56fe\u3001DAG \u56fe\u3001ER \u56fe\u7b49\u56fe\u5e94\u7528\u3002",date:"2023-05-06T00:00:00.000Z",formattedDate:"2023\u5e745\u67086\u65e5",tags:[{label:"antv/x6",permalink:"/apaas-front-doc/blog/tags/antv-x-6"},{label:"er",permalink:"/apaas-front-doc/blog/tags/er"}],readingTime:19.725,hasTruncateMarker:!0,authors:[{name:"\u9ec4\u632f\u654f",title:"\u70df\u82b1\u6613\u51b7",job_no:25748,url:"https://github.com/hzm0321",imageURL:"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.92fa.com%2Fpic%2FTX1251_03.jpg&refer=http%3A%2F%2Fimg.92fa.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1670915005&t=61e1ff50cd599d4affcc74dfa4b7545d",key:"hzm"}],frontMatter:{slug:"ER",title:"\u57fa\u4e8e antv/x6 \u5b9e\u73b0 ER \u56fe",authors:["hzm"],tags:["antv/x6","er"]},nextItem:{title:"TypeScript \u64cd\u4f5c\u7b26",permalink:"/apaas-front-doc/blog/TypeScript Operator"}},d={authorsImageUrls:[void 0]},u=[{value:"\u5b9e\u73b0\u6548\u679c",id:"\u5b9e\u73b0\u6548\u679c",level:2},{value:"\u6280\u672f\u6808",id:"\u6280\u672f\u6808",level:2},{value:"\u521d\u59cb\u5316 Graph",id:"\u521d\u59cb\u5316-graph",level:2},{value:"\u6ce8\u518c\u8282\u70b9",id:"\u6ce8\u518c\u8282\u70b9",level:2},{value:"\u6ce8\u518c\u8def\u7531",id:"\u6ce8\u518c\u8def\u7531",level:2},{value:"ERNode \u7ec4\u4ef6\u5b9e\u73b0",id:"ernode-\u7ec4\u4ef6\u5b9e\u73b0",level:2},{value:"\u8fde\u63a5\u6869\u7684\u5b9e\u73b0",id:"\u8fde\u63a5\u6869\u7684\u5b9e\u73b0",level:2},{value:"\u8282\u70b9\u548c\u8fb9\u6570\u636e\u7684\u751f\u6210",id:"\u8282\u70b9\u548c\u8fb9\u6570\u636e\u7684\u751f\u6210",level:2},{value:"\u9009\u4e2d\u8282\u70b9\u9ad8\u4eae\u5468\u56f4\u8fb9\u529f\u80fd",id:"\u9009\u4e2d\u8282\u70b9\u9ad8\u4eae\u5468\u56f4\u8fb9\u529f\u80fd",level:2},{value:"\u81ea\u52a8\u5e03\u5c40",id:"\u81ea\u52a8\u5e03\u5c40",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}],p={toc:u};function g(e){let{components:n,...i}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,i,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"X6 \u662f AntV \u65d7\u4e0b\u7684\u56fe\u7f16\u8f91\u5f15\u64ce\uff0c\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u5f00\u7bb1\u5373\u7528\u7684\u4ea4\u4e92\u7ec4\u4ef6\u548c\u7b80\u5355\u6613\u7528\u7684\u8282\u70b9\u5b9a\u5236\u80fd\u529b\uff0c\u65b9\u4fbf\u6211\u4eec\u5feb\u901f\u642d\u5efa\u6d41\u7a0b\u56fe\u3001DAG \u56fe\u3001ER \u56fe\u7b49\u56fe\u5e94\u7528\u3002")),(0,a.kt)("p",null,"\u672c\u6587\u9002\u7528\u4e8e\u6709\u4e00\u5b9a ",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh"},"antv/x6")," \u4f7f\u7528\u57fa\u7840\u7684\u5f00\u53d1\u8005\u3002"),(0,a.kt)("h2",{id:"\u5b9e\u73b0\u6548\u679c"},"\u5b9e\u73b0\u6548\u679c"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"alt \u5b9e\u73b0\u6548\u679c",src:t(8950).Z,width:"4234",height:"2234"})),(0,a.kt)("p",{align:"center"},"\u5b9e\u73b0\u6548\u679c\u793a\u610f\u56fe"),(0,a.kt)("p",null,"\u4e1a\u52a1\u5bf9\u8c61 ER \u56fe\u7528\u6765\u8868\u793a\u4e0d\u540c\u9886\u57df\u4e0b\u4e0d\u540c\u4e1a\u52a1\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u5982\u4e0a\u56fe\u6240\u793a:  "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e00\u5f20\u5361\u7247\u4ee3\u8868\u4e00\u4e2a\u8282\u70b9\uff08\u4e1a\u52a1\u5bf9\u8c61\uff09\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e0b\u6709\u591a\u4e2a\u5b57\u6bb5\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u8282\u70b9\u95f4\u5173\u7cfb\uff0c\u4f7f\u7528\u5e26\u6709\u5411\u7bad\u5934\u7684\u8fb9\u8868\u793a\u3002\u4e0d\u540c\u5173\u7cfb\u4f1a\u6709\u4e0d\u540c\u7684\u8fb9\u989c\u8272\u5bf9\u5e94\u5c55\u793a\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u70b9\u51fb\u9009\u4e2d\u67d0\u4e2a\u8282\u70b9\uff0c\u4e0e\u8be5\u8282\u70b9\u6240\u5173\u8054\u7684\u8fb9\u90fd\u4f1a\u52a0\u7c97\u9ad8\u4eae\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u5b58\u5728\u64cd\u4f5c\u6309\u94ae\uff0c\u53ef\u52a8\u6001\u5207\u6362\u6bcf\u4e2a\u8282\u70b9\u5185\u5c55\u793a\u7684\u5173\u8054/\u975e\u5173\u8054\u5b57\u6bb5\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u53ef\u901a\u8fc7\u6309\u94ae\u64cd\u4f5c\u4e1a\u52a1\u5bf9\u8c61\u7684\u589e\u5220\u6539\u67e5\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u53ef\u62d6\u62fd\u8282\u70b9\uff0c\u4f46\u662f\u4e0d\u80fd\u81ea\u5efa\u8fde\u7ebf\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u81ea\u52a8\u5e03\u5c40\u3002")),(0,a.kt)("h2",{id:"\u6280\u672f\u6808"},"\u6280\u672f\u6808"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"react V16"),(0,a.kt)("li",{parentName:"ul"},"mobx V4"),(0,a.kt)("li",{parentName:"ul"},"@antv/x6 V1"),(0,a.kt)("li",{parentName:"ul"},"@antv/x6-react-shape v1")),(0,a.kt)("h2",{id:"\u521d\u59cb\u5316-graph"},"\u521d\u59cb\u5316 Graph"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const graph = new Graph({\n  container: document.getElementById(CONTAINER_ID)!,\n  width: wrapperRef.current?.clientWidth || 0,\n  height: wrapperRef.current?.clientHeight || 0,\n  grid: {\n    visible: true,\n    size: 20,\n    args: {\n      color: '#f0f0f0',\n      thickness: 3,\n    },\n  },\n  background: { color: '#f8f8f8' },\n  interacting: {\n    nodeMovable: true, // \u4ec5\u5141\u8bb8\u8282\u70b9\u79fb\u52a8\n  },\n  scroller: {\n    enabled: true,\n    className: styles['graph-scroller'],\n    pannable: {\n      enabled: true,\n      eventTypes: ['leftMouseDown'],\n    },\n    autoResize: true,\n  },\n  minimap: {\n    enabled: true, // \u5f00\u542f\u7f29\u7565\u56fe\n    container: document.getElementById(MINI_MAP_ID)!,\n    width: 205,\n    height: 128,\n    padding: 0,\n  },\n  mousewheel: {\n    enabled: true,\n    modifiers: ['ctrl', 'meta'],\n  }, // \u5141\u8bb8\u9f20\u6807\u6eda\u8f6e\u7f29\u653e\u753b\u5e03\n  connecting: {\n    router: {\n      name: ER_ROUTER, // \u57fa\u4e8e er \u8def\u7531\u4fee\u6539\u540e\u7684\u81ea\u5b9a\u4e49\u8def\u7531\n      args: {\n        direction: 'H',\n      },\n    },\n    // \u5c4f\u853d\u4e00\u4e9b\u4e3b\u52a8\u8fde\u7ebf\u64cd\u4f5c\n    allowEdge: false,\n    allowPort: false,\n    allowBlank: false,\n    allowLoop: false,\n    allowMulti: false,\n    allowNode: false,\n  },\n});\n")),(0,a.kt)("p",null,"\u5728\u4ee5\u4e0a\u7684 ER \u56fe\u7684 Graph \u914d\u7f6e\u4ec5\u4f9b\u53c2\u8003\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u9700\u8981\u8c03\u6574\u3002\u5168\u90e8\u7684\u914d\u7f6e\u9879\u53ef\u53c2\u8003\u5b98\u7f51 ",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh/docs/api/graph/graph"},"Graph"),"\u3002"),(0,a.kt)("h2",{id:"\u6ce8\u518c\u8282\u70b9"},"\u6ce8\u518c\u8282\u70b9"),(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:t(39).Z,alt:"node",width:"50%"})),(0,a.kt)("p",null,"\u7531\u4e0a\u56fe\u5b9e\u73b0\u6548\u679c\u53ef\u4ee5\u770b\u51fa\uff0c\u6bcf\u4e2a\u8282\u70b9\u6709\u6837\u5f0f\u4ee5\u53ca\u5305\u542b\u90e8\u5206\u6309\u94ae\u4ea4\u4e92\u6548\u679c\uff0c\u4f7f\u7528 x6 \u9ed8\u8ba4\u7684\u63cf\u8ff0 svg \u6807\u7b7e\u7684 markup\u3001attrs \u7b49\u53c2\u6570\u5b9e\u73b0\u8f83\u4e3a\u590d\u6742\u3002\u56e0\u6b64\u6211\u4eec\u91c7\u7528",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh/docs/tutorial/advanced/react#%E6%B8%B2%E6%9F%93-react-%E8%8A%82%E7%82%B9"},"\u81ea\u5b9a\u4e49 react \u8282\u70b9"),"\u7684\u5f62\u5f0f\uff0c\u53bb\u521b\u5efa\u8282\u70b9\u3002",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("strong",{parentName:"p"},"\u6ce8\u518c React \u8282\u70b9\u65b9\u5f0f\u5982\u4e0b\uff1a"),(0,a.kt)("br",{parentName:"p"}),"\n","\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"Graph.registerReactComponent(...)")," \u65b9\u6cd5\u5c06 React \u7ec4\u4ef6\u6216\u8fd4\u56de React \u7ec4\u4ef6\u7684\u51fd\u6570\u6ce8\u518c\u5230\u7cfb\u7edf\u4e2d\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from 'react';\nimport { Graph } from '@antv/x6';\n\n/**\n * \u6ce8\u518c ER \u56fe\u8282\u70b9\n */\nexport function registerReactERNode() {\n  Graph.registerReactComponent(REACT_ER_NODE, <ERNode />);\n  return () => Graph.unregisterReactComponent(REACT_ER_NODE);\n}\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"<ERNode />")," \u4e3a ER \u56fe\u4e2d\u6bcf\u4e2a\u8282\u70b9\u7684 react \u7ec4\u4ef6\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\uff1a"),"  "),(0,a.kt)("p",null,"\u5728\u521d\u59cb\u5316\u753b\u5e03\u7684 useEffect \u4e2d\uff0c\u5728\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"new Graph")," \u4e4b\u524d\uff0c\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"registerReactERNode")," \u65b9\u6cd5\u3002",(0,a.kt)("inlineCode",{parentName:"p"},"registerReactERNode")," \u4f1a\u8fd4\u56de\u4e00\u4e2a\u9500\u6bc1\u7684\u65b9\u6cd5\uff0c\u5728 useEffect \u7684 return \u65b9\u6cd5\u4e2d\u8c03\u7528\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"useEffect(() => {\n  // \u6ce8\u518c react ER \u56fe\u8282\u70b9\n  const erReactNodeDispose = registerReactERNode();\n  // ......\n  // \u4ec5\u505a\u521d\u59cb\u5316\u5e03\u5c40\n  const graph = new Graph({......})\n\n  return () => {\n    graph.dispose();\n    erReactNodeDispose();\n    // ......\n  };\n}, []);\n")),(0,a.kt)("h2",{id:"\u6ce8\u518c\u8def\u7531"},"\u6ce8\u518c\u8def\u7531"),(0,a.kt)("p",null,"\u56e0\u4e3a x6 \u81ea\u5e26\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh/docs/api/registry/router#er"},"er \u8def\u7531"),"\u6ca1\u6709\u5b8c\u5168\u6ee1\u8db3\u573a\u666f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u5b98\u65b9\u63d0\u4f9b\u7684 er \u8def\u7531\u4e0a\u505a\u4e00\u4e0b\u53c2\u6570\u7684\u4fee\u6539\u3002\n\u4f7f\u7528\u5b98\u65b9\u4e3a\u6ce8\u518c\u81ea\u5b9a\u4e49\u8def\u7531\u63d0\u4f9b\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh/docs/api/registry/router/#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1"},"registerRouter")," \u65b9\u6cd5\u3002\u6807\u51c6\u7684\u5b98\u65b9 er \u8def\u7531\u5b9e\u73b0\u9700\u8981\u4ece x6 \u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/antvis/X6/blob/%40antv/x6%401.34.14/packages/x6/src/registry/router/er.ts"},"github \u6e90\u7801"),"\u4e2d\u590d\u5236\u51fa\u6765\u3002"),(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:t(1243).Z,alt:"node",width:"30.88%"}),(0,a.kt)("img",{src:t(6632).Z,alt:"node",width:"28%"})),(0,a.kt)("p",{align:"center"},"\u672a\u4f18\u5316\u524d\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u4f18\u5316\u540e"),(0,a.kt)("p",null,"\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u9488\u5bf9\u8282\u70b9\u81ea\u8eab\u7684\u5b57\u6bb5\u6307\u5411\u81ea\u5df1\u8fd9\u79cd\u60c5\u51b5\u505a\u4f18\u5316\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * \u6ce8\u518c ER \u8def\u7531\n */\nexport function registerERRouter() {\n  Graph.registerRouter(ER_ROUTER, (vertices, options, edgeView) => {\n    const offsetRaw = options.offset || 32;\n    const min = options.min == null ? 16 : options.min;\n\n    let offset = 0;\n    let { direction } = options;\n\n    const { sourceBBox, targetBBox } = edgeView;\n    const sourcePoint = sourceBBox.getCenter();\n    const targetPoint = targetBBox.getCenter();\n\n    if (typeof offsetRaw === 'number') {\n      offset = offsetRaw;\n    }\n\n    if (direction == null) {\n      let dx = targetBBox.left - sourceBBox.right;\n      let dy = targetBBox.top - sourceBBox.bottom;\n\n      if (dx >= 0 && dy >= 0) {\n        direction = dx >= dy ? 'L' : 'T';\n      } else if (dx <= 0 && dy >= 0) {\n        dx = sourceBBox.left - targetBBox.right;\n        if (dx >= 0) {\n          direction = dx >= dy ? 'R' : 'T';\n        } else {\n          direction = 'T';\n        }\n      } else if (dx >= 0 && dy <= 0) {\n        dy = sourceBBox.top - targetBBox.bottom;\n        if (dy >= 0) {\n          direction = dx >= dy ? 'L' : 'B';\n        } else {\n          direction = 'L';\n        }\n      } else {\n        dx = sourceBBox.left - targetBBox.right;\n        dy = sourceBBox.top - targetBBox.bottom;\n        if (dx >= 0 && dy >= 0) {\n          direction = dx >= dy ? 'R' : 'B';\n        } else if (dx <= 0 && dy >= 0) {\n          direction = 'B';\n        } else if (dx >= 0 && dy <= 0) {\n          direction = 'R';\n        } else {\n          direction = Math.abs(dx) > Math.abs(dy) ? 'R' : 'B';\n        }\n      }\n    }\n\n    if (direction === 'H') {\n      direction = targetPoint.x - sourcePoint.x >= 0 ? 'L' : 'R';\n    } else if (direction === 'V') {\n      direction = targetPoint.y - sourcePoint.y >= 0 ? 'T' : 'B';\n    }\n\n    if (offsetRaw === 'center') {\n      if (direction === 'L') {\n        offset = (targetBBox.left - sourceBBox.right) / 2;\n      } else if (direction === 'R') {\n        offset = (sourceBBox.left - targetBBox.right) / 2;\n      } else if (direction === 'T') {\n        offset = (targetBBox.top - sourceBBox.bottom) / 2;\n      } else if (direction === 'B') {\n        offset = (sourceBBox.top - targetBBox.bottom) / 2;\n      }\n    }\n\n    let coord: 'x' | 'y';\n    let dim: 'width' | 'height';\n    let factor;\n    const horizontal = direction === 'L' || direction === 'R';\n\n    if (horizontal) {\n      if (targetPoint.y === sourcePoint.y) {\n        return [...vertices];\n      }\n\n      factor = direction === 'L' ? 1 : -1;\n      coord = 'x';\n      dim = 'width';\n    } else {\n      if (targetPoint.x === sourcePoint.x) {\n        return [...vertices];\n      }\n\n      factor = direction === 'T' ? 1 : -1;\n      coord = 'y';\n      dim = 'height';\n    }\n\n    const source = sourcePoint.clone();\n    const target = targetPoint.clone();\n\n    source[coord] += factor * (sourceBBox[dim] / 2 + offset);\n    target[coord] -= factor * (targetBBox[dim] / 2 + offset);\n\n    if (horizontal) {\n      const sourceX = source.x;\n      const targetX = target.x;\n      const sourceDelta = sourceBBox.width / 2 + min;\n      const targetDelta = targetBBox.width / 2 + min;\n      if (targetPoint.x > sourcePoint.x) {\n        if (targetX <= sourceX) {\n          source.x = Math.max(targetX, sourcePoint.x + sourceDelta);\n          target.x = Math.min(sourceX, targetPoint.x - targetDelta);\n        }\n      } else if (targetX >= sourceX) {\n        source.x = Math.min(targetX, sourcePoint.x - sourceDelta);\n        target.x = Math.max(sourceX, targetPoint.x + targetDelta);\n      }\n    } else {\n      const sourceY = source.y;\n      const targetY = target.y;\n      const sourceDelta = sourceBBox.height / 2 + min;\n      const targetDelta = targetBBox.height / 2 + min;\n      if (targetPoint.y > sourcePoint.y) {\n        if (targetY <= sourceY) {\n          source.y = Math.max(targetY, sourcePoint.y + sourceDelta);\n          target.y = Math.min(sourceY, targetPoint.y - targetDelta);\n        }\n      } else if (targetY >= sourceY) {\n        source.y = Math.min(targetY, sourcePoint.y - sourceDelta);\n        target.y = Math.max(sourceY, targetPoint.y + targetDelta);\n      }\n    }\n\n    // \u5982\u679c\u662f\u81ea\u5df1\u8fde\u81ea\u5df1\n    if (sourcePoint.x === targetPoint.x) {\n      target.x = source.x;\n    }\n\n    return [source.toJSON(), ...vertices, target.toJSON()];\n  });\n\n  return () => Graph.unregisterRouter(ER_ROUTER);\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6ce8\u518c\u8def\u7531\u65b9\u5f0f\u5982\u4e0b\uff1a"),"\n\u5728\u521d\u59cb\u5316\u753b\u5e03\u7684 useEffect \u4e2d\uff0c\u5728\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"new Graph")," \u4e4b\u524d\uff0c\u8c03\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh/docs/api/registry/router/#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1"},"registerERRouter")," \u65b9\u6cd5\u3002registerERRouter \u4f1a\u8fd4\u56de\u4e00\u4e2a\u9500\u6bc1\u7684\u65b9\u6cd5\uff0c\u5728 useEffect \u7684 return \u65b9\u6cd5\u4e2d\u8c03\u7528\u3002",(0,a.kt)("br",{parentName:"p"}),"\n","\u4f8b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"useEffect(() => {\n  // \u6ce8\u518c ER \u8def\u7531\n  const erRouteDispose = registerERRouter();\n  // ......\n  // \u4ec5\u505a\u521d\u59cb\u5316\u5e03\u5c40\n  const graph = new Graph({......})\n\n  return () => {\n    graph.dispose();\n    erRouteDispose();\n    // ......\n  };\n}, []);\n")),(0,a.kt)("h2",{id:"ernode-\u7ec4\u4ef6\u5b9e\u73b0"},"ERNode \u7ec4\u4ef6\u5b9e\u73b0"),(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:t(6841).Z,alt:"node",width:"37%"}),(0,a.kt)("img",{src:t(3559).Z,alt:"node",width:"60%"})),"\u8fd9\u662f\u6211\u4eec\u8981\u5b9e\u73b0\u7684\u4e00\u4e2a ER \u8282\u70b9\u7684\u6837\u5f0f\u3002\u5728\u6e32\u67d3\u5199\u6cd5\u4e0a\u548c\u666e\u901a react \u7ec4\u4ef6\u6ca1\u4ec0\u4e48\u533a\u522b\uff0c\u4e00\u4e2a\u6807\u9898\u533a\u57df\u52a0\u4e00\u4e2a\u5217\u8868\u533a\u57df\uff0c\u4ee5\u53ca\u64cd\u4f5c\u6309\u94ae\u89e6\u53d1\u83dc\u5355\u3002\u533a\u522b\u5728\u4e8e\u5982\u4f55\u89e6\u53d1\u6570\u636e\u72b6\u6001\u66f4\u65b0\u3002",(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"<ERNode/>"),"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'import React, { memo } from "react";\nimport { ReactShape } from "@antv/x6-react-shape";\nimport { isEqual } from "lodash";\n\ninterface Props {\nnode?: ReactShape;\n}\n\nconst ERNode: React.FC<Props> = ({ node }) => {\n// \u83b7\u53d6\u8282\u70b9\u6570\u636e\nconst data = node?.getData() as BusinessObject & NodeExtraProps;\nconst {\nselectedNodeId,\ndomainCode,\n// ......\n} = data;\n\n// \u66f4\u65b0\u8282\u70b9\u65b9\u6cd5\u793a\u4f8b\nconst handleShowNonRelationalFields = () => {\nnode?.setData({\n...node?.getData(),\nisShowNonRelationalFields: !isShowNonRelationalFields,\n});\n};\n\nreturn // ......\n};\n\n\nexport default memo(ERNode, (prev, next) => {\n// \u7cbe\u786e\u63a7\u5236\u8282\u70b9\u6e32\u67d3\nreturn !isEqual(prev.node?.getData(), next.node?.getData());\n});\n')),(0,a.kt)("p",null,"\u4e0e\u666e\u901a\u7684 React \u7ec4\u4ef6\u66f4\u65b0\u65b9\u5f0f\u4e0d\u540c\uff0cERNode \u7ec4\u4ef6\u63a5\u6536\u4e00\u4e2a ",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh/docs/api/model/node"},"node")," \u5c5e\u6027\uff0c\u8be5\u5c5e\u6027\u4e3a x6 \u8282\u70b9\u5b9e\u4f8b\u3002node \u8282\u70b9\u4e0b\u6709\u4e2a ",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh/docs/tutorial/basic/cell#data"},"data")," \u5c5e\u6027\u3002\u4e0e\u8282\u70b9/\u8fb9\u5173\u8054\u7684\u4e1a\u52a1\u6570\u636e\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u901a\u5e38\u4f1a\u5c06\u67d0\u4e9b\u4e1a\u52a1\u6570\u636e\u5b58\u5728\u8282\u70b9/\u8fb9\u7684 data \u4e0a\u3002\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"node.getData()")," \u65b9\u6cd5\u53ef\u4ee5\u83b7\u53d6\u5230\u8282\u70b9/\u8fb9\u7684 data\u3002"),(0,a.kt)("p",null,"\u4e3a\u4e86\u7cbe\u786e\u63a7\u5236 ERNode \u7ec4\u4ef6\u6e32\u67d3\uff0c\u907f\u514d\u8282\u70b9\u8fc7\u591a\u65f6\u89e6\u53d1\u65e0\u6548\u6e32\u67d3\u5f71\u54cd\u7ec4\u4ef6\u6027\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u76d1\u542c node \u4e0a data \u7684\u53d8\u5316\uff0c\u6765\u66f4\u65b0\u8282\u70b9\u7684\u6e32\u67d3\u3002"),(0,a.kt)("p",null,"\u5982\u679c\u60f3\u8981\u4e3b\u52a8\u89e6\u53d1\u8282\u70b9\u7684\u66f4\u65b0\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"node.setData(...)")," \u65b9\u6cd5\u6765\u5b9e\u73b0\u3002"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"\u5982\u679c\u60f3\u8981\u5728 ERNode \u7ec4\u4ef6\u5185\u83b7\u53d6\u5916\u90e8 React Context\uff08\u5305\u62ec\u9879\u76ee\u4e2d\u5e38\u7528\u7684 mobx store\uff09 \u7684\u503c\uff0cx6 \u6587\u6863\u4e2d\u63d0\u4f9b\u4e86 ",(0,a.kt)("a",{parentName:"p",href:"https://x6.antv.vision/zh/docs/tutorial/advanced/react#%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%B8%8B%E6%96%87"},"Portal \u673a\u5236"),"\u3002\u4f46\u662f\u4f7f\u7528\u4e86\u8be5\u65b9\u6cd5\u83b7\u53d6\u5916\u90e8\u4e0a\u4e0b\u6587\u4f1a\u5bfc\u81f4\u5c0f\u5730\u56fe\u7ec4\u4ef6\u65e0\u6cd5\u6e32\u67d3\u3002\u56e0\u6b64\u5c0f\u5730\u56fe\u548c X6ReactPortalProvider \u53ea\u80fd\u4e8c\u9009\u4e00\u3002")),(0,a.kt)("p",null,"\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cHTML/React/Vue \u8282\u70b9\u5185\u5bb9\u90fd\u662f\u6e32\u67d3\u5728 SVG \u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/foreignObject"},"foreignObject")," \u5143\u7d20\u5185\u90e8\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u7ecf\u5e38\u4f1a\u51fa\u73b0\u4e00\u4e9b\u5f02\u5e38\u7684\u6e32\u67d3\u884c\u4e3a\u3002\u4e3b\u8981\u8868\u73b0\u5f62\u5f0f\u4e3a\u8282\u70b9\u5185\u5bb9\u5c55\u793a\u4e0d\u5168\u6216\u8005\u8282\u70b9\u5185\u5bb9\u95ea\u70c1\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6765\u89c4\u907f\uff1a\n\u8282\u70b9\u5185\u90e8\u5143\u7d20\u7684 css \u6837\u5f0f\u4e2d\u4e0d\u8981\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"position:absolute\u3001position:relative\u3001transform\u3001opacity"),"\u3002\n\u5728 Safari \u6d4f\u89c8\u5668\u4e0a\u517c\u5bb9\u6027\u8868\u73b0\u4f1a\u66f4\u52a0\u5dee\u3002",(0,a.kt)("strong",{parentName:"p"},"\u5982\u679c\u9879\u76ee\u9700\u8981\u517c\u5bb9 Safari \u6d4f\u89c8\u5668\uff0c\u5efa\u8bae\u4e0d\u8981\u5728\u7ec4\u4ef6\u4e2d\u4f7f\u7528 react \u7ec4\u4ef6\u5e93\uff08antd\u3001c7n \u7b49\uff09\u7684\u590d\u6742\u7ec4\u4ef6\u3002\u5982\u679c\u4f7f\u7528\u4e86\uff0c\u9700\u8981\u53bb Safari \u6d4f\u89c8\u5668 \u9a8c\u8bc1\u4e00\u4e0b\u662f\u5426\u517c\u5bb9\u3002")),(0,a.kt)("h2",{id:"\u8fde\u63a5\u6869\u7684\u5b9e\u73b0"},"\u8fde\u63a5\u6869\u7684\u5b9e\u73b0"),(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:t(7715).Z,alt:"node",width:"100%"})),(0,a.kt)("p",null,"\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u8282\u70b9\u4e0e\u8282\u70b9\u95f4\u5b58\u5728\u8fde\u7ebf\u5173\u7cfb\u3002\u6839\u636e x6 \u5bf9\u8fb9\u8fde\u63a5\u4f4d\u7f6e\u7684\u8981\u6c42\uff0c\u6211\u4eec\u9700\u8981\u5728\u8282\u70b9\u4e0a\u5b9a\u4e49\u8fde\u63a5\u6869\u3002\u6839\u636e\u8fde\u63a5\u6869\u7684\u4f4d\u7f6e\uff0c\u7cbe\u51c6\u8fde\u7ebf\u3002",(0,a.kt)("br",{parentName:"p"}),"\n","\u56e0\u4e3a\u8fde\u63a5\u6869\u7684\u4f4d\u7f6e\u6570\u636e\u548c\u5b57\u6bb5\u7c7b\u578b\u6570\u636e\u6709\u5173\u8054\uff0c\u6240\u4ee5",(0,a.kt)("strong",{parentName:"p"},"\u5728\u751f\u6210\u521d\u59cb\u5316\u8282\u70b9\u6570\u636e\u7684\u65f6\u5019\u6ce8\u5165\u8fde\u63a5\u6869\u6570\u636e"),"\u3002\u6bcf\u4e2a\u8fde\u63a5\u6869\u7684\u5f62\u72b6\u4e3a\u5b57\u6bb5\u884c\u7684\u5f62\u72b6\uff0c\u5c42\u7ea7 ",(0,a.kt)("inlineCode",{parentName:"p"},"z-index")," \u8bbe\u7f6e\u4e3a -1\uff0c\u9690\u85cf\u5728\u8282\u70b9\u5c42\u7ea7\u4e4b\u540e\u3002"),(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:t(1268).Z,alt:"node",width:"35%"}),(0,a.kt)("img",{src:t(5771).Z,alt:"node",width:"35%"})),(0,a.kt)("p",null,"\u9ed1\u8272\u533a\u57df\u5373\u4e3a\u751f\u6210\u7684\u8fde\u63a5\u6869\u533a\u57df\u3002\u8fde\u63a5\u6869\u751f\u6210\u7684\u53c2\u6570\u53ef\u53c2\u8003\u5982\u4e0b\u4ee3\u7801\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const generatePorts = (id: string, attrs: Record<string, any>) => {\n  return {\n    id,\n    markup: [\n      {\n        tagName: 'rect',\n        selector: 'portBody',\n      },\n    ],\n    args: {\n      position: 'top',\n    },\n    attrs: {\n      portBody: {\n        width: ER_NODE_WIDTH,\n        strokeWidth: 1,\n        stroke: 'rgba(0,0,0,0)',\n        fill: 'rgba(0,0,0,0)',\n        magnet: true,\n        transform: 'matrix(1,0,0,1,0,0)',\n        ...attrs,\n      },\n    },\n    zIndex: -1,\n  };\n};\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"attrs")," \u4e3a\u989d\u5916\u5c5e\u6027\uff0c\u5728\u5217\u8868\u6570\u636e\u904d\u5386\u65f6\u52a8\u6001\u6ce8\u5165\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// \u8bbe\u7f6e\u8fde\u63a5\u6869\nconst ports: any[] = [];\n// \u8bbe\u7f6e\u6807\u9898\u8fde\u63a5\u6869\nports.push(\n  generatePorts(item.businessObjectId, {\n    height: ER_LINE_HEIGHT,\n  })\n);\n// \u8bbe\u7f6e\u4e1a\u52a1\u5bf9\u8c61\u5b57\u6bb5\u8fde\u63a5\u6869\nitem.businessObjectFields.forEach((field, index) => {\n  // \u5982\u679c\u662f\u5173\u8054\u7c7b\u578b\n  if (RELATION_TYPE.includes(field.componentType)) {\n    ports.push(\n      generatePorts(field.businessObjectFieldId, {\n        height: ER_LINE_HEIGHT,\n        refY: ER_TITLE_HEIGHT + ER_LINE_HEIGHT * index,\n      })\n    );\n  }\n});\n")),(0,a.kt)("p",null,"\u6839\u636e\u4e0d\u540c\u7684\u5217\u8868 y \u8f74\u4f4d\u7f6e\u7ed3\u5408\u7d22\u5f15\u751f\u6210 ",(0,a.kt)("inlineCode",{parentName:"p"},"refY")," \u53c2\u6570\uff0c\u4f7f\u5f97\u8fde\u63a5\u6869\u77e9\u5f62\u5728 y \u8f74\u4ea7\u751f\u504f\u79fb\u5b9a\u4e49\u5230\u6240\u5bf9\u5e94\u7684\u5173\u8054\u5b57\u6bb5\u533a\u57df\u3002"),(0,a.kt)("p",null,"ERNode \u8282\u70b9\u4e2d\u6709\u4e2a",(0,a.kt)("inlineCode",{parentName:"p"},"\u9690\u85cf/\u663e\u793a\u975e\u5173\u7cfb\u5b57\u6bb5"),"\u7684\u529f\u80fd\uff0c\u8be5\u529f\u80fd\u4f1a\u5f71\u54cd\u5230\u8fde\u63a5\u6869\u7684\u751f\u6210\u3002\u6211\u4eec\u901a\u8fc7\u5728 node \u7684 data \u6570\u636e\u4e0a\u7ed1\u5b9a ",(0,a.kt)("inlineCode",{parentName:"p"},"isShowNonRelationalFields")," \u5c5e\u6027\u6765\u63a7\u5236\u662f\u5426\u663e\u793a\u975e\u5173\u7cfb\u5b57\u6bb5\u3002\u6bcf\u5f53\u503c\u5207\u6362\u65f6\uff0c\u8fde\u63a5\u6869\u4f4d\u7f6e\u4e5f\u5f97\u91cd\u65b0\u8ba1\u7b97\u3002"),(0,a.kt)("h2",{id:"\u8282\u70b9\u548c\u8fb9\u6570\u636e\u7684\u751f\u6210"},"\u8282\u70b9\u548c\u8fb9\u6570\u636e\u7684\u751f\u6210"),(0,a.kt)("p",null,"\u5728\u521d\u59cb\u5316\u8282\u70b9\u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u628a\u540e\u7aef\u4f20\u8fc7\u6765\u7684\u6570\u636e\u683c\u5f0f\u5316\u6210 x6 \u8282\u70b9\u9700\u8981\u7684\u6570\u636e\u683c\u5f0f\u3002"),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"1",label:"\u540e\u7aef\u7684\u6570\u636e",default:!0,mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"enum SourceType {\n  PREDEFINE = 'PREDEFINE', // \u7cfb\u7edf\u9884\u7f6e\n  PLATFORM = 'PLATFORM', // \u5e73\u53f0\u81ea\u5b9a\u4e49\n  TENANT = 'TENANT', // \u79df\u6237\u81ea\u5b9a\u4e49\n}\n\n// \u4e1a\u52a1\u5bf9\u8c61\u5b57\u6bb5\u6570\u636e\uff08\u5305\u542b\u5173\u8054\uff09\ninterface BusinessObjectField {\n  businessObjectFieldId: string;\n  businessObjectId: string;\n  businessObjectFieldCode: string;\n  businessObjectFieldName: string;\n  requiredFlag: boolean;\n  componentType: FieldComponentType; // \u4e1a\u52a1\u5bf9\u8c61\u7ec4\u4ef6\u7c7b\u578b\n  inheritSourceType: string;\n  requiredFlagValue: string;\n  masterBusinessObjectId?: string; // \u5173\u8054\u7684\u4e1a\u52a1\u5bf9\u8c61id\n  linkRelationType?: string; // \u8fde\u63a5\u7c7b\u578b ONE_TO_ONE ONE_TO_MANY\n  relateType?: string; // \u5173\u7cfb\u7c7b\u578b\n}\n\n// \u4e1a\u52a1\u5bf9\u8c61\u9ad8\u7ea7\u5173\u8054\u6570\u636e\ninterface BusinessObjectAssociate {\n  _token: string;\n  businessObjectAssociateId: string;\n  associateName: string;\n  associateType: string;\n  associateCode: string;\n  linkRelationType: string;\n  associateBusinessObjectId: string;\n  preConditionFlag: boolean;\n}\n\n// \u4e1a\u52a1\u5bf9\u8c61\u6570\u636e\ninterface BusinessObject {\n  _token: string;\n  businessObjectId: string;\n  businessObjectCode: string;\n  businessObjectName: string;\n  domainId: string;\n  domainCode: string;\n  publishStatus: string;\n  businessObjectFields: BusinessObjectField[];\n  skipResetPhysicalSyncFlag: boolean;\n  extendFieldCreatedFlag: boolean;\n  updatePhysicalFlag: boolean;\n  sourceType: SourceType;\n  businessObjectCategory: string;\n  flexFieldEnabledFlag: boolean;\n  extendTableEnabledFlag: boolean;\n  objectVersionNumber: number;\n  businessObjectAssociateList?: BusinessObjectAssociate[];\n  relationBusinessObjectIds?: string[]; // \u4e0e\u6b64\u5bf9\u8c61\u5173\u8054\u7684\u4e1a\u52a1\u5bf9\u8c61id\n  extendFieldPrefixRule?: string;\n  physicalModelType?: string;\n}\n"))),(0,a.kt)(s.Z,{value:"2",label:"\u683c\u5f0f\u5316\u540e\u7684 x6 \u6570\u636e",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// \u8fde\u63a5\u6869\u6570\u636e\ninterface Port {\n  id: string;\n  markup: any[];\n  args: {\n    position: string;\n  };\n  attrs: {\n    portBody: {\n      width: number;\n      strokeWidth: number;\n      stroke: string;\n      fill: string;\n      magnet: boolean;\n      transform: string;\n      height: number;\n      refY?: number;\n    };\n  };\n  zIndex: number;\n}\n\n// x6 \u8282\u70b9\u6570\u636e\ninterface Node {\n  id: string;\n  component: string;\n  data: object; // \u6e32\u67d3 ERNode \u7ec4\u4ef6\u6240\u9700\u7684\u6570\u636e\n  height: number;\n  width: number;\n  shape: string; // \u533a\u5206\u8282\u70b9\u6216\u8fb9\n  ports: Port[];\n}\n\n// x6 \u8fb9\u6570\u636e\ninterface Edge {\n  attrs: any[];\n  labels: any[];\n  shape: string;\n  source: {\n    cell: string;\n    port: string;\n  };\n  target: {\n    cell: string;\n    port: string;\n  };\n}\n\ntype GraphData = Node[] | Edge[];\n\n")))),(0,a.kt)("p",null,"\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"formatBoDataToReactERGraph")," \u65b9\u6cd5\uff08\u89c1\u9879\u76ee\u4ee3\u7801\uff09\u53bb\u683c\u5f0f\u5316\u540e\u7aef\u6570\u636e\uff0c\u8be5\u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e00\u4e2a\u7b26\u5408x6\u6e32\u67d3\u6570\u636e\u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u90fd\u662f\u4e00\u4e2a\u8282\u70b9\u6216\u8fb9\u7684\u6570\u636e\u3002  "),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"\u540e\u7aef\u8fd4\u56de\u7684\u8fb9\u6570\u636e\u5305\u542b\u5168\u90e8\u4e0e\u6b64\u8282\u70b9\u6709\u5173\u8054\u7684\u6570\u636e\u3002\u4f46\u662f\u9875\u9762\u4e0a\u5c55\u793a\u7684\u8282\u70b9\u5e76\u4e0d\u5168\u662f\u4e0e\u6b64\u8282\u70b9\u6709\u5173\u8054\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u65b9\u6cd5\u7684\u6700\u540e\u4e00\u6b65\u9700\u8981\u5bf9\u8fb9\u6570\u636e\u8fdb\u884c\u8fc7\u6ee4\uff0c",(0,a.kt)("strong",{parentName:"p"},"\u53ea\u4fdd\u7559\u4e0e\u753b\u5e03\u4e0a\u8282\u70b9\u6709\u5173\u8054\u7684\u6570\u636e"),"\u3002\u5982\u679c\u6dfb\u52a0\u7684\u8fb9\u6570\u636e\u7684\u6307\u5411 id \u7684\u8282\u70b9\u6ca1\u6709\u5728\u753b\u5e03\u4e2d\uff0c\u5219\u4f1a\u62a5\u9519\u3002")),(0,a.kt)("p",null,"\u751f\u6210\u8fb9\u7684\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// \u8bbe\u7f6e\u666e\u901a\u5b57\u6bb5\u7bad\u5934\nitem.businessObjectFields.forEach((field) => {\n  if (field.linkRelationType) {\n    const edge: any = {\n      shape: 'edge',\n      source: {\n        cell: item.businessObjectId,\n        port: field.businessObjectFieldId,\n      },\n      target: {\n        cell: field.masterBusinessObjectId,\n        port: field.masterBusinessObjectId,\n      },\n      attrs: {\n        line: getEdgeLine(field.componentType),\n      },\n      labels: getEdgeLabels(field.linkRelationType),\n    };\n    edgesData.push(edge);\n  }\n});\n")),(0,a.kt)("p",null,"\u8fb9\u7684\u8d77\u7ec8\u70b9\u6570\u636e\u90fd\u9700\u8981 ",(0,a.kt)("inlineCode",{parentName:"p"},"cell")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"port")," \u5c5e\u6027\u6765\u51b3\u5b9a\u8fb9\u7684\u5750\u6807\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cell")," \u4ee3\u8868\u662f\u76ee\u6807\u8282\u70b9\uff0c\u53d6\u81ea ",(0,a.kt)("inlineCode",{parentName:"li"},"businessObjectFieldId"),"\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"port")," \u4ee3\u8868\u662f\u5f53\u524d\u8282\u70b9\u4e2d\u7684\u54ea\u4e2a\u8fde\u63a5\u6869\uff0c\u53d6\u81ea ",(0,a.kt)("inlineCode",{parentName:"li"},"businessObjectId"),"\u3002  ")),(0,a.kt)("h2",{id:"\u9009\u4e2d\u8282\u70b9\u9ad8\u4eae\u5468\u56f4\u8fb9\u529f\u80fd"},"\u9009\u4e2d\u8282\u70b9\u9ad8\u4eae\u5468\u56f4\u8fb9\u529f\u80fd"),(0,a.kt)("div",{align:"center"},(0,a.kt)("img",{src:t(7715).Z,alt:"node",width:"100%"})),(0,a.kt)("p",null,"\u6bcf\u4e2a ER \u8282\u70b9\u5206\u4e3a",(0,a.kt)("inlineCode",{parentName:"p"},"\u9009\u4e2d"),"\u548c",(0,a.kt)("inlineCode",{parentName:"p"},"\u975e\u9009\u4e2d"),"\u4e24\u79cd\u72b6\u6001\u3002\u5f53\u8282\u70b9\u4e3a\u9009\u4e2d\u72b6\u6001\u65f6\uff0c\u4f1a\u9ad8\u4eae\u8282\u70b9\u548c\u4e0e\u8282\u70b9\u76f8\u8fde\u7684\u8fb9\u3002",(0,a.kt)("br",{parentName:"p"}),"\n","\u5224\u65ad\u753b\u5e03\u4e2d\u54ea\u4e2a\u8282\u70b9\u88ab\u9009\u4e2d\u7684\u6570\u636e\u5b58\u5728\u4e8e\u8282\u70b9\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"data")," \u6570\u636e\u4e2d\uff0c\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"selectedNodeId")," \u5c5e\u6027\u6765\u63a7\u5236\u3002\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"p"},"selectedNodeId")," \u548c\u5f53\u524d\u8282\u70b9\u7684 id \u76f8\u7b49\uff0c\u5219\u4ee3\u8868\u5f53\u524d\u8282\u70b9\u88ab\u9009\u4e2d\u3002",(0,a.kt)("br",{parentName:"p"}),"\n","\u5728\u5916\u90e8\u6570\u636e\u7ba1\u7406\u4e2d\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"selectedNodeId")," \u5b58\u5728\u4e8e Mobx Store \u4e2d\u7edf\u4e00\u7ba1\u7406\uff0c\u5e76\u4e14\u548c x6 \u753b\u5e03\u4e2d\u7684\u8282\u70b9\u6570\u636e\u8fdb\u884c\u7ed1\u5b9a\u7684\u3002\u5f53\u66f4\u65b0 Mobx Store \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"selectedNodeId")," \u7684\u65f6\u5019\uff0c\u4f1a\u89e6\u53d1 x6 \u753b\u5e03\u4e2d\u8282\u70b9\u7684\u66f4\u65b0\u3002",(0,a.kt)("br",{parentName:"p"}),"\n","\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 graph \u63d0\u4f9b\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"on \u65b9\u6cd5"),"\uff0c\u53bb\u76d1\u542c\u8282\u70b9\u70b9\u51fb\u4e8b\u4ef6\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"function addNodeClickListener({ node }: NodeView.EventArgs['node:click']) {\n  if (!graph) return;\n  erStore.setState('selectedNodeId', node.getData()?.businessObjectId || '');\n}\n\n// \u6dfb\u52a0\u70b9\u51fb\u4e8b\u4ef6\ngraph?.on('node:click', addNodeClickListener);\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"useEffect(() => {\n  selectNode();\n}, [erStore.getState('selectedNodeId')]);\n")),(0,a.kt)("p",null,"\u8fd9\u6837\u4f7f\u5f97\u526f\u4f5c\u7528\u903b\u8f91\u5168\u90e8\u88ab\u63d0\u53d6\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"selectNode")," \u8fd9\u4e00\u4e2a\u65b9\u6cd5\u4e2d\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"export const NORMAL_SOURCE_EDGE_ATTR = {\n  strokeWidth: 1,\n  sourceMarker: {\n    r: 4,\n    cx: 4,\n  },\n};\n\nexport const SELECTED_SOURCE_EDGE_ATTR = {\n  strokeWidth: 2,\n  sourceMarker: {\n    r: 5,\n    cx: 5,\n  },\n};\n\nconst curNodeRef = useRef<Cell>(); // \u5f53\u524d\u9009\u4e2d\u7684\u8282\u70b9\nconst curEdgesRef = useRef<Edge[]>([]); // \u5f53\u524d\u9009\u4e2d\u7684\u8fb9\n\n// \u9009\u4e2d\u4e00\u4e2a\u8282\u70b9\nfunction selectNode() {\n  const selectedNode = graph?.getCellById(erStore.getState('selectedNodeId'));\n  const selectedNodeId = selectedNode?.getData()?.businessObjectId || '';\n\n  // \u8fd8\u539f\u4e0a\u4e00\u4e2a\u9009\u4e2d\u8282\u70b9\u989c\u8272\n  if (curNodeRef.current) {\n    curNodeRef.current?.setData({\n      ...curNodeRef.current.getData(),\n      selectedNodeId,\n    });\n  }\n  // \u8fd8\u539f\u8fb9\n  if (isArray(curEdgesRef.current) && curEdgesRef.current.length > 0) {\n    curEdgesRef.current?.forEach((edge) => {\n      edge.attr('line/strokeWidth', NORMAL_SOURCE_EDGE_ATTR.strokeWidth);\n      edge.attr('line/sourceMarker', {\n        ...(edge.getAttrs().line.sourceMarker as any),\n        ...NORMAL_SOURCE_EDGE_ATTR.sourceMarker,\n      });\n    });\n  }\n\n  if (selectedNode && graph) {\n    // \u8bbe\u7f6e\u9009\u4e2d\u72b6\u6001\n    selectedNode.toFront();\n    selectedNode.setData({\n      ...selectedNode.getData(),\n      selectedNodeId,\n    });\n\n    // \u8bbe\u7f6e\u8fb9\u5bbd\u5ea6\n    const edges = graph.getConnectedEdges(selectedNode);\n    edges.forEach((edge) => {\n      edge.attr('line/strokeWidth', SELECTED_SOURCE_EDGE_ATTR.strokeWidth);\n      edge.attr('line/sourceMarker', {\n        ...(edge.getAttrs().line.sourceMarker as any),\n        ...SELECTED_SOURCE_EDGE_ATTR.sourceMarker,\n      });\n    });\n\n    curNodeRef.current = selectedNode;\n    curEdgesRef.current = edges;\n  } else {\n    curNodeRef.current = undefined;\n    curEdgesRef.current = [];\n  }\n}\n")),(0,a.kt)("p",null,"\u5728\u6bcf\u6b21\u65b0\u9009\u62e9\u4e00\u4e2a\u8282\u70b9\u65f6\u8bfb\u53d6\u4e0a\u4e00\u6b21\u5b58\u50a8\u7684\u8282\u70b9\u6570\u636e\u3002\u5982\u679c\u6709\u6570\u636e\u5c31\u8fd8\u539f\uff0c\u518d\u8bbe\u7f6e\u5f53\u524d\u9009\u62e9\u8282\u70b9\u7684\u6570\u636e\u5e76\u5907\u4efd\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"curNodeRef")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"curEdgesRef")," \u4e2d\u3002"),(0,a.kt)("h2",{id:"\u81ea\u52a8\u5e03\u5c40"},"\u81ea\u52a8\u5e03\u5c40"),(0,a.kt)("p",null,"\u81ea\u52a8\u5e03\u5c40\u65b9\u6cd5\u4fee\u6539\u81ea @antv/layout \u4e2d\u7b2c\u4e09\u65b9\u5f00\u53d1\u8005\u5199\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/antvis/layout/blob/master/src/layout/er/index.ts"},"ErLayout"),"\u3002\u4e3b\u8981\u4fee\u6539\u4e86\u5bf9\u6570\u636e\u683c\u5f0f\u7684\u517c\u5bb9\u548c\u8282\u70b9\u73af\u7ed5\u7684\u95f4\u8ddd\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"/**\n * \u6267\u884c ER \u5e03\u5c40\u7b97\u6cd5\n * @constructor\n */\nexport function executeERLayout(graph: Graph) {\n  const nodes = graph.getNodes();\n  const edges = graph.getEdges();\n  const width = graph.container.clientWidth;\n  const height = graph.container.clientHeight;\n  // \u52a0\u8f7d ER \u56fe\u5e03\u5c40\n  const ERLayoutInstance = new ERLayout({\n    nodes,\n    edges,\n    nodeMinGap: 20,\n    width,\n    height,\n  });\n\n  return new Promise<void>((resolve) => {\n    ERLayoutInstance.execute().then(({ nodes: newNodes = [] }) => {\n      nodes.forEach((item) => {\n        const node = newNodes.find((n) => n.id === item.id);\n        if (node) {\n          item.position(node.x || 0, node.y || 0);\n        }\n      });\n      graph.zoomToFit({ padding: 10, maxScale: 1 });\n      resolve();\n    });\n  });\n}\n")),(0,a.kt)("h2",{id:"\u53c2\u8003\u8d44\u6599"},"\u53c2\u8003\u8d44\u6599"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://x6.antv.vision/zh/docs/tutorial/about"},"antv/x6 \u5b98\u65b9\u6587\u6863(v1\u7248\u672c)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/zh-CN/docs/Web/SVG"},"MDN SVG \u76f8\u5173\u6587\u6863"))))}g.isMDXComponent=!0},7715:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/er-cell-5fc587d39aeda7ff273adc4338fa16da.png"},1268:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/er-no-port-54f3a91f31999c9b0108da3ac7292eb6.png"},6841:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/er-node-01-5aa41456d6c64a0d63918d7f0795ab1e.png"},3559:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/er-node-02-e88903ad54d3008975938a541b8b830c.png"},5771:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/er-port-84705792722a91d78f88307514ac1505.png"},6632:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/er-router-optimize-70893775470c470a66eb3e5ff63de25d.png"},1243:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/er-router-5df9fd6d33e52972306658a8cc5663a2.png"},39:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/node-4bfc3eaa3265fff4955c5f8403d933c7.png"},8950:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/main-929c334f97d6e7e10a2fc2a7547395c7.png"}}]);