---
sidebar_position: 12
---


# 12. 冷启动提速 split-router-loader

### 简介
`split-router-loader` 实现原理主要是基于对 `umi` 的`配置式路由文件`在 webpack 开发模式下文件 `loader` 阶段动态生成，以实现按需加载。

### 用法
1. 引入 `split-router-loader` 代码  
飞搭工程的 `config/config.dev.ts` 引入 `split-router-loader` 代码。

```ts
import { IConfig } from 'umi';
import path from "path"; // ref: https://umijs.org/config/

const config: IConfig = {
  define: {
  // ......
  chainWebpack: (c) => {
    c.module
      .rule('split-router-loader')
      .test(/\.tsx?$/)
      .use('split-router-loader')
      .loader(
        path.join(__dirname,
          '../scripts/loaders/split-router-loader.js'
        )
      )
      .end();
    return c;
  },
};

export default config;

```
2. 定义需要拆分的路由  
修改飞搭工程的 `scripts/loaders/router.js` 文件，以 `{key:string: values:string[]}` 形式维护需要拆分的路由。  
例：
```ts
const routerModeMap = {
  script: [
    '/hmde/script-event', // 路由对应的 path（仅识别第一层）
    '/hmde/script-execution-log',
    '/hmde/script-utility',
    '/hmde/preset-function-config'
  ],
}

module.exports = {
  routerModeMap,
}
```

3. 定义新的 start 启动项  
修改飞搭工程的 `packages/你的子模块/package.json` 文件，复制原有的 start 启动脚本，添加变量 `SPILT_ROUTER=你添加的routerModeMap中的 key 值`。  
例：
```bash    
"start-script": "cross-env UMI_ENV=dev SPILT_ROUTER=script NODE_OPTIONS=--max-old-space-size=4096 node ../../node_modules/umi/bin/umi.js dev",
```



<maintainer authors={["hzm"]}/>

